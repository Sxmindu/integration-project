<?xml version="1.0" encoding="UTF-8"?>
<sequence name="DeleteBookSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property expression="get-property('uri.var.book_id')" name="book_id"/>
    <log category="INFO">
        <message>Deleting Book ${params.pathParams.book_id}</message>
    </log>
    <dataServiceCall serviceName="BookDataService">
        <operations type="single">
            <operation name="getBook">
                <param name="book_id" expression="get-property('book_id')"/>
            </operation>
        </operations>
        <source type="inline"/>
        <target type="body"/>
    </dataServiceCall>
    <filter xpath="${exists($.Book)}">
        <then>
            <dataServiceCall serviceName="BookDataService">
                <operations type="single">
                    <operation name="deleteBook">
                        <param name="book_id" expression="get-property('book_id')"/>
                    </operation>
                </operations>
                <source type="inline"/>
                <target type="body"/>
            </dataServiceCall>
            <payloadFactory media-type="json">
                <format>
                    {
                        "message": "Book Deleted!"
                    }
                </format>
            </payloadFactory> 
        </then>
        <else>
            <payloadFactory media-type="json">
                <format>
                    {
                        "message": "No books found for book id $1 to delete"
                    }
                </format>
                <args>
                    <arg expression="get-property('book_id')"/>
                </args>
            </payloadFactory>
        </else>
    </filter>
    <respond/>
</sequence>